<html>
<head>
    <link href="../resources/css/doc-style.css" media="all" rel="stylesheet" type="text/css" />
    <script src="../resources/js/jff5neq.js" type="text/javascript"></script>
    <script type="text/javascript">
        try{Typekit.load();}catch(e){}
    </script>
    <script src="../resources/js/jquery.min.js"></script>
    <script src="../resources/js/vkbeautify.js"></script>

    <title>Setup SSO</title>

    <script src="../resources/js/getAppValues.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div class="header clearfix">
    <div class="logo-container">
        <img src="../resources/img/okta-logo-white.png" alt="Okta" />
    </div>
</div>
<div class="okta-instructions">
<h1>How to Configure SAML 2.0 for Salesforce</h1>
    <div id="loginAdminApp" class="okta-callout okta-error" style="display: none;"><span class="icon-24 icon-error"></span>
        <p>This setup might fail without parameter values that are customized for your organization. Please use the Okta Administrator Dashboard to add an application and view the values that are specific for your organization.</p>
    </div>


<p>This document contains instructions for configuring SAML 2.0 for Salesforce (see <a href="#SAML">Configuring SAML</a> below), as well as additional, useful information you may need about <a href="#sp-initiated-saml">How to Configure SP-Initiated SAML between Salesforce and Okta</a>, and <a href="#del-auth">How to Configure Delegated Authentication in Salesforce (optional)</a>. 

<hr>

<h2>Contents</h2>
<ul>
<li><a href="#SAML">Configuring SAML</a></li>

<li><a href="#sp-initiated-saml">How to Configure SP-Initiated SAML between Salesforce and Okta</a>
<ul>
<li><a href="#domain">Setting up My Domain in SalesForce</a></li>
<li><a href="#reconfigure">Reconfiguring Single Sign-On Settings</a></li>
<li><a href="#default-auth">Choosing Okta as the Default Authentication Service</a></li>
<li><a href="#verify">Verifying SP-Initiated SAML</a></li>
</ul>
</li>


<li><a href="#del-auth">How to Configure Delegated Authentication in Salesforce (optional)</a></li>
<li><a href="#test">Test it Out</a></li>


</ul>
<hr>

<a name="SAML"></a><h2>Configuring SAML</h2>


<ol>
    <li><p><a href="https://login.salesforce.com" target="_blank">CLICK HERE</a> to log in to Salesforce with the same administrator username and password-token used for User Management settings in Okta.</p></li>

        <li>
            <p>Navigate to <strong>Setup > Security Controls > Single Sign-On Settings</strong>:</p>
      
    <p><img src="images/apps/sf1.png" alt="sf1.png" /></p></li>
  

    <li><p>On the Single Sign-On Settings page, click <strong>Edit</strong>:</p>
<p><img src="images/apps/salesforce_new_1a.png" alt="salesforce_new_1a.png" /></p></li>



<li><p>Check the <strong>SAML Enabled</strong> box to enable the use of SAML Single-Sign On, then click <strong>Save</strong>:</p>

    <p><img src="images/apps/salesforce_new1.png" alt="salesforce_new1.png" /></p></li>


<li><p>Next, in the list at the bottom of your page, select <strong>New</strong> to add a new SAML Single-Sign On configuration. A <strong>SAML Single Sign-On Setting Detail</strong> page will open, enter the following information (an example of the page is shown here):</p>

<p><img src="images/apps/salesforce_new_1.png" alt="salesforce_new_1.png" /></p>



<li><p>Enter the following:</p>
<p>Unless otherwise noted, leave the default values as-is.</p>
<ul>
<li><p><strong>Name</strong>: Enter a name of your choice.</p></li>
<li><p><strong>SAML Version</strong>: Make sure this is set to <strong>2.0</strong>. This should be enabled by default.</p></li> 
<li><p><strong>Issuer</strong>: Copy and paste the following:</p>
<p><kbd id="issuer">Sign into the Okta Admin dashboard to generate this value</kbd></p>
</li>

<li><p><strong>Identity Provider Certificate</strong>: Download, then upload the following certificate into this field:</p>
<p><kbd id="downloadCertificate">Sign into the Okta Admin dashboard to generate this value</kbd></p></li>


<li><p><strong>Identity Provider Login URL</strong>: Copy and paste the following:</p>
<p><kbd id="signOnUrl">Sign into the Okta Admin dashboard to generate this value</kbd></p>
<p>This URL will authenticate your users when they attempt to log in directly to Salesforce or click on a deep link in Salesforce and are not currently authenticated. This is required if you want to enable SP-Initiated SAML authentication.</p></li>



<li><p><strong>Identity Provider Logout URL</strong>: Optional. Copy and paste the following:</p>
<p><kbd id="signOutUrl">Sign into the Okta Admin Dashboard to generate this variable.</kbd></p></li>


<li><p><strong>API Name</strong>: Enter an API name of your choice.</p></li>




<li><p><strong>Entity ID</strong>:</p>
<ul>
<li><p>If you have a custom domain setup, use <strong>https://[customDomain].my.salesforce.com</strong></p></li>
<li><p>If you do not have a custom domain setup, use <strong>https://saml.salesforce.com</strong></p></li>

</ul>
</li>

<li><p>Click <strong>Save</strong>.</p></li>


</ul>
</li>


<li><p>Make note of the <strong>Salesforce Login URL</strong> that will appear after you click <strong>Save</strong>.</p></li>



<li><p>In Okta, select the <strong>Sign On</strong> tab for the Salesforce app, then click <strong>Edit</strong>.</p>
<ul>
<li><p>Enter the <strong>Salesforce Login URL</strong> into the <strong>Login URL</strong> field.</p></li>

<li><p>If you are using a custom domain, then enter that value into the <strong>Custom Domain</strong> field, otherwise leave it blank.</p></li>

<li><p>Click <strong>Save</strong>.</p></li>
</ul>
<img src="images/apps/salesforce_new_2.png" alt="salesforce_new_2.png" />
</li>

<li>Done!</li>
    </ol><br />


<hr>


<a name="sp-initiated-saml"></a><h2>How to Configure SP-Initiated SAML between Salesforce and Okta</h2>

<p>By completing the steps above, your users will be able to access SalesForce from a single click on the Okta User Dashboard. This process of logging into Salesforce or other cloud apps from Okta is known as IDP-Initiated SAML. However, if at any point your users navigate directly to Salesforce, or click any deep links that directs them to SalesForce first instead of Okta, they won’t be given the same single-sign on experience unless SP-Initiated SAML is also configured. This is an optional configuration. Use the steps below to set up SP-Initiated SAML.</p>



<a name="domain"></a><h3>Setting up My Domain in SalesForce</h3>
<p>Use of SP-Initiated SAML requires your SalesForce instance to be setup with a customized domain name specific to your company. In Salesforce, these are referred to as <strong>My Domains</strong>. To add a My Domain:</p>

<ol>
<li><p>In Salesforce, click <strong>Setup</strong>.</p></li>
<li><p>Click <strong>Domain Management</strong> to open the sub-menu.</p></li>
<li><p>Click <strong>My Domain</strong>.</p>
<p><img src="images/apps/salesforce_new2.png" alt="salesforce_new2.png" /></p>
</li>
<li><p>Provide a name for your org, check availability, then choose <strong>Register Domain</strong>.</p></li>


<li><p>At this point your new org name in SalesForce (<strong>https://[orgname].my.salesforce.com</strong>) will be published to the internet and should become widely available for use within 12-24 hours. You can test this by trying to navigate to your new org name in a browser window.</p></li>
</ol>


<a name="reconfigure"></a><h3>Reconfiguring Single Sign-On Settings</h3>

<p>While your new <strong>My Domain</strong> is being setup, you can make some configuration changes to your SalesForce and Okta single-sign on settings to use your new <strong>My Domain</strong> instead of the default values, as described here:</p>


<ol>
<li><p>In Salesforce, navigate back to <strong>Security Controls & Single Sign-On Settings</strong>.</p></li>
<li><p>Locate the configuration you set up previously from the list on the page, then click <strong>Edit</strong>.</p>
<p><img src="images/apps/salesforce_new3.png" alt="salesforce_new3.png" /></p>
</li>

<li><p>From here change the <strong>Entity ID</strong> field:</p>
<ul>
<li><p>From: <strong>https://saml.salesforce.com</strong>.</p></li>
<li><p>To: <strong>https://[customDomain].my.salesforce.com</strong>, using the domain URL you just created.</p></li>
</ul>
</li>

<li><p>Navigate to the Okta Admin Console and locate your <strong>SalesForce</strong> configuration.</p></li>
<li><p>Select the <strong>SSO</strong> tab.</p>
<p><img src="images/apps/salesforce_new4.png" alt="salesforce_new4.png" /></p>

</li>

<li><p>Make sure that the <strong>Login URL</strong> matches the login URL provided in SalesForce on the <strong>Single-Sign On Settings</strong> tab.</p></li>

<li><p>Make sure that the <strong>Custom Domain</strong> field matches the name of the custom domain you have created.</p>
<p>If your domain is <strong>acme.my.salesforce.com</strong>, enter <strong>acme</strong>.</p>
</li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>

<a name="default-auth"></a><h3>Choosing Okta as the Default Authentication Service</h3>
<p>Once your <strong>My Domain</strong> is live, you’ll be able to specify Okta as the default preferred Authentication Service each time users navigate to your specific domain.</p>

<ol>
<li><p>In Salesforce, navigate back to <strong>Domain Management > My Domains</strong>.</p></li>
<li><p>Under <strong>Authentication Configuration</strong>, click <strong>Edit</strong>.</p></li>
<li><p>In the <strong>Authentication Service</strong> drop down menu, check the box next to the Okta instance you’ve set up in single-sign on settings.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>

<a name="verify"></a><h3>Verifying SP-Initiated SAML</h3>
<p>With configuration now complete, you can easily verify that SP-Initiated SAML has been properly configured.
Simply navigate to your Salesforce Domain URL and you should be redirected to the Okta sign-on page for your org. Authenticating into Okta with a user assigned to Salesforce should then provide you access to SalesForce.</p>

<hr>



    <a name="del-auth"></a><h2>How to Configure Delegated Authentication in Salesforce (optional)</h2>
    <div class="okta-callout okta-info">
        <span class="icon-24 icon-info"></span>
        <p><strong>Please note:</strong> Delegated authentication is an optional integration that can be used in addition to SAML 2.0.</p>
    </div>
    <div class="okta-callout okta-info">
        <span class="icon-24 icon-info"></span>
        <ul>
            <li><strong>What does this feature do?</strong>
                <p>Delegated authentication enables various integrations with Salesforce — like the Microsoft Outlook plugin — as well as giving you the ability to lock a user out of Salesforce. Unlike SAML 2.0 single sign-on, delegated authentication is turned on at the user profile level. You have the ability to enable delegated authentication for a single user or large group; it all depends on who has the user profile where the <strong>Is Single Sign-On Enabled</strong> permission is enabled.</p>
            </li>
            <li>
                <p><strong>Where can I find this feature in my version of Salesforce?</strong></p>
                <p>You can't see this form until Salesforce has enabled delegated authentication for your organization. Once enabled, the delegated authentication form is located on the <strong>Single Sign-On Settings</strong> page in Salesforce — the same place where you configure SAML 2.0.</p>
            </li>
        </ul>
    </div>
    <h3>Contact Salesforce to enable delegated authentication</h3>
    <p>Call Salesforce at <strong>1-800-667-6389</strong> and ask them to enable <strong>delegated authentication</strong> for your organization. You can also do this by opening a case in the Salesforce customer service application.</p>
    <p>Once Salesforce enables delegated authentication you can proceed with the steps below.</p>
    <h3>Enter your Delegated Gateway URL</h3>
    <p>Go to the <strong>Single Sign-On Settings</strong> page located in the <strong>Setup</strong> &gt; <strong>Security Controls</strong> section of Salesforce. Click the <strong>Edit</strong> button to display a form similar to the screenshot below.</p>
    <ol>
        <li>
            <p>Copy and paste the URL below into the <strong>Delegated Gateway URL</strong> field:</p>
            <kbd id="delAuthUrl">Sign into the Okta Admin dashboard to generate this value</kbd></li>
        <li>
            <p>Click <strong>Save</strong></p>
        </li>
    </ol>
    <p><img src="images/apps/sf3.png" alt="sf3.png" /></p>
    <h3>Tryout delegated authentication single sign-on with a cloned user profile</h3>
    <p>We recommend creating a test user profile so you can experiment with this feature on a single user. If you feel comfortable with this feature then you can skip to the next section.</p>
    <ul>
        <li>
            <p>Go to the <strong>Profiles</strong> page located in the <strong>Setup</strong> &gt; <strong>Manage Users</strong> section of Salesforce</p>
        </li>
        <li>
            <p>Open a User Profile you would like to experiment with</p>
        </li>
        <li>
            <p>Click the <strong>Clone</strong> button to make a copy of this profile. Using a cloned profile allows you to avoid impacting any other users who have the original profile.</p>
        </li>
        <li>
            <p>Give the cloned profile a name</p>
        </li>
        <li>
            <p>Click <strong>Save</strong></p>
        </li>
    </ul>
    <h3>Enable delegated authentication single sign-on for a user profile</h3>
    <div class="okta-callout okta-warning"><span class="icon-24 icon-warning"></span>
        <p><strong>IMPORTANT</strong>: Enabling single sign-on for a user profile will affect every user who is assigned that user profile. If you want to experiment with a single user first, we recommend creating a cloned profile (see above) to test with.</p>
    </div>
    <ul class="bullets margin-top-0">
        <li>
            <p>Go to the <strong>Profiles</strong> page located in the <strong>Setup</strong> &gt; <strong>Manage Users</strong> section of Salesforce</p>
        </li>
        <li>
            <p>Click <strong>Edit</strong> on the user profile and scroll down to the <strong>General User Permissions</strong> section</p>
        </li>
        <li>
            <p>Check the <strong>Is Single Sign-On Enabled</strong> checkbox</p>
        </li>
        <li>
            <p>Click <strong>Save</strong></p>
        </li>
    </ul>
    <h3>Enable delegated authentication single sign-on for a Salesforce user</h3>
    <div class="okta-callout okta-warning"><span class="icon-24 icon-warning"></span>
        <p><strong>IMPORTANT</strong>: Do not enable delegated authentication for the Salesforce user used by Okta to connect to the Salesforce User Management APIs. The API user is specified in Okta on the Salesforce User Management tab.</p>
    </div>
    <ul>
        <li>
            <p>Go to the <strong>Users</strong> page located in the <strong>Setup</strong> &gt; <strong>Manage Users</strong> section of Salesforce</p>
        </li>
        <li>
            <p>Click <strong>Edit</strong> for a user you want to enable single sign-on for</p>
        </li>
        <li>
            <p>Select a <strong>Profile</strong> that has delegated authentication single sign-on enabled (use the cloned profile if you are experimenting)</p>
        </li>
        <li>
            <p>Click <strong>Save</strong></p>
        </li>
    </ul>
    <h3>Assign your single sign-on enabled Salesforce user to an Okta user</h3>
    <ul>
        <li>
            <p>In Okta, go to the People list and click a person's name to view their profile</p>
        </li>
        <li>
            <p>Click <strong>Assign Application</strong></p>
        </li>
        <li>
            <p>Select <strong>Salesforce</strong> from the list and <strong>enter a Salesforce username that has delegated authentication enabled</strong></p>
        </li>
        <li>
            <p>Click <strong>Save</strong></p>
        </li>
    </ul>

<hr>

    <a name="test"></a><h2>Test it out!</h2>
    <ul>
        <li>
            <p><a href="https://login.salesforce.com" target="_blank">CLICK HERE</a> to go to the Salesforce login page</p>
        </li>
        <li>
            <p>Enter the <strong>Salesforce username</strong> you used in the previous section</p>
        </li>
        <li>
            <p>Enter the <strong>Okta password</strong> for the Okta user assigned the <strong>Salesforce username</strong> above</p>
        </li>
        <li>
            <p>Click <strong>Login</strong></p>
        </li>
    </ul>
    <p>Assuming you logged in successfully, you can use these credentials for salesforce client application integrations like the Microsoft Outlook plugin and other APIs.</p>

<hr>
    <h2>Done!</h2>
    <p>Your users are ready to single sign-on to Salesforce!</p>
</div>
</body>
</html>
